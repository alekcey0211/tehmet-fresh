# ТЕХМЕТ

## Технологии

Сайт разработан с использованием следующих инструментов

- [nodejs](https://nodejs.org/en/)
- [deno](https://deno.land)
- [fresh](https://fresh.deno.dev)
- [preact](https://preactjs.com)
- [twind](https://twind.dev)
- [pm2](https://pm2.io)
- [typescript](https://www.typescriptlang.org)

---

## Хостинг

Сайт размещен на VDS (виртуальная машина) Адхил на
[netangels](https://panel.netangels.ru/cloud/vm/67922/)

Сайт работает на `http://localhost:8000` на хостинге

Чтобы перенаправить запросы были изменены настройки `nginx` по пути
`/etc/nginx/sites-available/tehmet.su.conf`. Пример файла конфигурации находится
по адресу `/home/web/tehmet-fresh/tehmet.su.conf`

За счет этого весь трафик со старого сайта на [php](https://www.php.net) был
перенаправлен на `http://localhost:8000`.

От старого сайта осталась только админка `https://tehmet.su/simpla/index.php`

---

## Запуск

Сайт работает под управлением [deno](https://deno.land), для этого его нужно
запустить через "Терминал".

Нужно авторизироваться под `root` пользователем и выполнить следующие команды,
Для мониторинга и контролем работы сайта использовался [pm2](https://pm2.io).

С помощью этого инструмента сайт автоматически перезапускается в случае
перезапуска сервера. Также он позволяет перезапустить сайт, если были внесены
изменения в код.

```bash
cd /home/web/tehmet-fresh
pm2 start tehmet
```

Чтобы перезапустить сайт также нужно зайти в "Терминал" под `root` пользователем

```bash
cd /home/web/tehmet-fresh
pm2 restart tehmet
```

---

## Исходный код

Весь код сайта расположен на хостинге в папке `/home/web/tehmet-fresh`

После изменений в коде, сайт нужно всегда перезапускать, как это сделать описано в разделе "Запуск"

Все новые изображение следует добавлять в папку `/static/img/`. ВАЖНО, при указание ссылок на изображение не нужно указывать папку `/static`, она не учитывается. Нужно сразу начинать с название папки внутри `static`, например `/img/logo/example.png`. Сайт поддерживает отображение изображений в современных форматах [webp](https://en.wikipedia.org/wiki/WebP) и [avif](https://en.wikipedia.org/wiki/AVIF). Для того, чтобы такая картинка заработала на сайте вам потребуется (не обязательно) добавить ее рядом с оригиналом. Конвертировать изображение в эти форматы можно на сайте https://squoosh.app.
Такие картинки занимают намного меньше места, а разница не заметна пользователю.

Все новые файлы следует добавлять в папку `/static/files/`

---

## Изменения контента

Для изменения данных о товарах, категориях, производителях нужно по прежнему
использовать админку [simpla](https://tehmet.su/simpla/index.php). Все изменения
будут моментально появляться на сайте.

Также управление содержимым сайта ведется из папки `/home/web/tehmet-fresh/db`,
в которой расположены файлы в формате `json`.

- `config.json` используется для общий настроек всего сайта.
  - `categoriesWithPrice` отвечает за отображение цен на сайте. Чтобы цена
    отобразилась нужно внести категорию товара в этот список через запятую в
    кавычках и тогда цена появится на сайте. Например
  ```json
  {
    "categoriesWithPrice": ["konvektory", "sv_mat"]
  }
  ```
  - `showPrice` отвечает за отображение цен на сайте. Если потребуется
    отобразить все цены, который внесены в базу данных
  ```json
  {
    "showPrice": true
  }
  ```
- `banner.json` отвечает за отображение баннеров на странице
  [каталога](`https://tehmet.su/catalog`). `topSlider` отвечает за отображение
  баннера сверху, `bottomSlider` за отображение баннера снизу, `bestPurchase`
  ссылка на предложение. В `topSlider` и `bottomSlider` может быть
  неограниченной кол-во рекламных блоков

```json
{
  "bestPurchase": "ССЫЛКА НА ТОВАР ИЛИ ЛЮБАЯ ДРУГАЯ",
  "topSlider": [
    {
      "img": "ПУТЬ ДО КАРТИНКИ",
      "link": "ССЫЛКА НА РЕКЛАМНЫЙ БАННЕР"
    },
    ...
  ],
  "bottomSlider": [
    {
      "img": "ПУТЬ ДО КАРТИНКИ",
      "link": "ССЫЛКА НА РЕКЛАМНЫЙ БАННЕР"
    },
    ...
  ]
}
```

- `best-month-manager.json` отвечает за отображение лучшего сотрудника. В поле
  `fio` требуется ввести ФИО сотрудника чтобы оно отобразилось на сайте. Фото
  сотрудника при этом хранится в папке `/static/img/employee`. Формат название
  изображений сотрудника `фамилия-имя-отчество.jpg` и все маленькими буквами

```json
{
  "fio": "ФИО СОТРУДНИКА"
}
```

- `certificates.json` отвечает за отображение сертификатов на сайте. Количество
  сертификатов не ограничено.
- `original` - оригинальное изображение, может быть очень большого разрешения,
  отображется при открытии галереи сертификатов
- `preview` - изображение который отображаются в списке сертификатов, лучше не
  использовать картинки юольшого разрешения
- `alt` - название сертификата
- `width` - ширина оригинального изображения в пикселях, нужно для корректной
  отображение в галерее
- `height` - высота оригинального изображения в пикселях, нужно для корректной
  отображение в галерее

```json
[
  {
    "original": "ПУТЬ ДО ОРИГИНАЛЬНОЙ КАРТИНКИ",
    "preview": "ПУТЬ ДО КАРТИНКИ ДЛЯ ПРЕВЬЮ",
    "alt": "НАЗВАНИЕ СЕРТИФИКАТА",
    "width": "ШИРИНА ОРИГИНАЛЬНОЙ КАРТИНКИ В ПИКСЕЛЯХ",
    "height": "ВЫСОТА ОРИГИНАЛЬНОЙ КАРТИНКИ В ПИКСЕЛЯХ"
  },
  ...
]
```

- `cities.json` - отвечает за список городов который отображаются в "Географии
  продаж"

```json
[
  "Альметьевск",
  "Апатиты",
  "Барнаул",
  ...
]
```

- `contacts.json` - контакты сайта
- `title` - название контакта (используется для отображение на Яндекс картах)
- `city` - город расположение контакта
- `phone` - телефон
- `address` - адрес
- `workMode` - режим работы
- `email` - почта
- `coords` - координаты точки для Яндекс карты

```json
[
  {
    "title": "Головной офис",
    "city": "Екатеринбург",
    "phone": "+7 (343) 288-26-88",
    "address": "620085, г. Екатеринбург, Аптекарская, 47, помещение 22",
    "workMode": "пн-пт с 9.00 до 18.00",
    "email": "info@tehmet.su",
    "coords": [56.76714, 60.605847]
  },
  ...
]
```

- `defaulter.json` - отвечает за список "Неплательщиков"

```json
[
  {
    "companyName": "ООО «ЭЛЕМЕТ» (ИНН 7451383493)",
    "city": "Челябинск",
    "related": [
      "ООО «ПКФ МЕТСТРОЙ» (ИНН 7451413571)",
      "ООО «Автогенпромснаб» (ООО «АПС») (ИНН 7448170375)",
      "ИП Обласов Дмитрий Анатольевич (744919423300)"
    ],
    "comment": "Получил товар, не рассчитался, бросил фирму, открыл новую и работает от нее, человек не готов нести ответственность по своим обязательствам."
  },
  ...
]
```

- `employee-reviews.json` - отзывы сотрудников о работе

```json
[
  {
    "fio": "Елизавета Панова (помощник руководителя)",
    "review": "Мои многочисленные требования к работе соблюдены волшебным образом. У нас приятный и дружный коллектив, комфортные условия работы. При желании возможен карьерный рост."
  },
  ...
]
```

- `employee.json` - список сотрудников. Фото сотрудников хранится в папке
  `/static/img/employee`. Формат название изображений сотрудника
  `фамилия-имя-отчество.jpg` и все маленькими буквами
  - `lastName` - фамилия
  - `firstName` - имя
  - `middleName` - отчество
  - `post` - должность
  - `phone` - телефон
  - `email` - почта
  - `whatsapp` - ссылка на whatsapp
  - `icq` - номер аськи

```json
[
  {
    "lastName": "Глушков",
    "firstName": "Денис",
    "middleName": "Игоревич",
    "post": "Генеральный директор",
    "phone": "+7 (343) 288-26-88",
    "email": "dir@tehmet.su",
    "whatsapp": "",
    "icq": ""
  },
  ...
]
```

- `news.json` - список новостей. Формат данных новостей из админки не позволял
  нормально отображать его на сайте. Поэтому все новости с сайта были выгружены
  в этот список. Новые новости нужно добавлять сюда
- `title` - заголовок новости
- `date` - дата новости
- `fileName` - название файла с изображением для новости. Файлы находятся по
  адресу `/static/img/news`
- `description` - текст новости
- `videoId` - идентификатор видео с ютуба, если вместо фото требуется
  использовать видео

```json
[
  {
	"title": "Поздравляем с днем народного единства!",
	"date": "03.11.2021",
	"fileName": "-1.png",
	"description": "",
	"videoId": ""
  },
  ...
]
```

- `partners.json` - список партнеров
- `src` - путь к файлу с изображением логотипа компании
- `name` - название компании

```json
[
  { "src": "/img/logo/1.png", "name": "NSSW логотип компани" },
  { "src": "/img/logo/2.png", "name": "МЭЦ логотип компани" },
  { "src": "/img/logo/3.png", "name": "KOBELCO логотип компани" },
  { "src": "/img/logo/4.png", "name": "СЗСМ логотип компани" },
  { "src": "/img/logo/5.png", "name": "ESAB логотип компани" },
  { "src": "/img/logo/6.png", "name": "bohler логотип компани" },
  { "src": "/img/logo/7.png", "name": "СВАРОГ логотип компани" },
  { "src": "/img/logo/8.png", "name": "КЕДР логотип компани" }
]
```

- `popular-categories.json` - список популярных категорий (нужно указывать
  ссылки на категории в каталоге), который отображаются в самом низу сайта (в
  футере)

```json
[
  "svarochnaya-provoloka",
  "svarochnye-elektrody",
  "ab_mat",
  "komplektuyuschie-dlya-svarki",
  "ugloshlifovalnaya-mashina-ushm",
  "svarochnoe-oborudovanie"
]
```
- `public-life-photos.json` - список фото который отображаются на странице `/about/career` в блоке "Организация общественной жизни и корпоративной культуры “ТЕХМЕТ”"
 - `src` - путь к изображению
 - `alt` - описание изображения (не обязательно, нужно для "доступности" сайта для людей с ограниченными возможностями)
 - `cols` - кол-во колонок которые занимает фото
 - `rows` - кол-во cnhjr которые занимает фото
```json
[
  {
    "src": "/img/content/932965b3cdee421c4b0f39180f736e5c.jpg",
    "alt": "6 women sitting at the table",
    "cols": 2,
    "rows": 2
  },
  {
    "src": "/img/content/e759ddc646474cd065e0b4e647fb8dd7.jpg",
    "alt": "group of people standing on white floor tiles"
  },
  ...
]
```
- `vacancies.json` - список вакансий
 - `isArchive` - отвечает за отображение вакансии на сайте. Добавил это свойство чтобы вакансию можно было скрыть не удаляя совсем, вдруг она потребуется снова и тогда достаточно будет поставить `"isArchive": false`
```json
[
  {
    "title": "Бухгалтер",
    "link": "buhgalter",
    "isArchive": true,
    "contactPhone": "+7 (343) 288-26-88 (доб.116)",
    "contactEmail": "personal@tehmet.su"
  },
  {
    "title": "Менеджер",
    "link": "menedzher",
    "isArchive": false,
    "contactPhone": "+7 (343) 288-26-88 (доб.116)",
    "contactEmail": "personal@tehmet.su"
  },
  ...
]
```
- `video.json` - список видео на сайте (возможно ненужный блок, ведь видео на сайте очень давно не обновлялись)
 - `id` - идентификатор видео на ютуб
 - `title` - заголовок видео
 - `date` - дата публикации видео
```json
[
  {
    "id": "6r42ys60Zps",
    "title": "Веселые съемки в компании \"Техмет\"!",
    "date": "07.08.2017"
  },
  {
    "id": "H7rBYPxuzKA",
    "title": "Видеопоздравление с 8 МАРТА!",
    "date": "07.08.2017"
  },
  ...
]
```